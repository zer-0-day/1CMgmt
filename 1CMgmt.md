# 1CMgmt

PowerShell-модуль для установки, обновления и администрирования 1С:Предприятие

Внимание: модуль находится в разработке, интерфейс и функции могут меняться.

Описание модуля
1CMgmt — PowerShell-модуль (версии 5.1), предназначенный для установки, обновления и администрирования серверов и платформы 1С:Предприятие. Размещён в PSGallery для простоты установки и обновления.

Требования
• Windows PowerShell 5.1
• Права администратора для установки и настройки сервисов и задач планировщика
• Доступ к PSGallery (powershellgallery.com)

Установка и обновление модуля

  1. Запустите PowerShell от имени администратора.
  2. Установите модуль и разрешите загрузку из PSGallery:
    Install-Module -Name 1CMgmt -Force
  3. Импортируйте модуль в текущую сессию:
    Import-Module 1CMgmt
  4. Запустите главное меню:
    Invoke-1CMenu
  

Порядок установки и обновления сервера

  1. Создайте папку 1Cv8.adm в корне любого логического диска (например, D:\1Cv8.adm).
  2. Скопируйте туда архив новой версии сервера 1С.
  3. В PowerShell запустите:
      Invoke-1CMenu
  4. Выберите «Установка сервера 1С» из подменю "так же можно запустить задачу из подменю "Меню обслуживания сервера 1С"" – при первом запуске создаст сервисного пользователя USR1CV8, папку srvinfo, настроит права и сервис.
    При обновлении выберите «Обновление сервера 1С» – модуль автоматически найдёт последнюю версию в 1Cv8.adm и проведёт обновление, обновив символическую ссылку current.

Сжатие журналов регистрации
• Ручной запуск:
Compress-1Clogs
По умолчанию:
– архивируются файлы старше 7 дней
– хранятся архивы 90 дней
– логи и архивы остаются в исходных папках
• С пользовательскими параметрами:
Compress-1Clogs -FileDays 14 -ArchiveDays 60

Создание задачи в Планировщике

1. В главном меню выберите «Меню управления задачами в планировщике Windows» или вызовите напрямую:
   Invoke-1CTaskMenu
2. Выберите:
   – «Создать задачу архивации логов (по умолчанию)»
   – «Создать задачу архивации логов (с параметрами)» – укажите время запуска, FileDays и ArchiveDays.

Структура меню и описание команд
Главное меню (Invoke-1CMenu)
Стартовая точка – выбор одной из секций: установка/обновление сервера, сжатие журналов, планировщик и т. д.

Подменю обслуживания сервера 1С (Меню обслуживания сервера 1С)
– установка и обновление сервера 1С
– запуск отдельных функций модуля вручную

Подменю управления задачами планировщика Windows (Invoke-1CTaskMenu)
– настройка запуска функций модуля в планировщике Windows

Описание основных функций
Compress-1Clogs
Сжатие файлов журнала регистрации:
-FileDays <int> – дни хранения логов до архивации
-ArchiveDays <int> – срок хранения архивов
-Path <string> – путь к папке с логами (по умолчанию стандартные)
Find-1CDistroFolder – поиск папки с дистрибутивами 1С (1Cv8.adm)
Get-1C – информация о сервере: пути и размеры каталогов журналов для каждой базы
Get-1CInstalledVersion – вывод установленных версий платформы 1С
Get-1CModuleHelp – вывод списка команд и справки по модулю
Install-1CPlatform – установка платформы 1С (для чистой установки и обновления)
Install-1CServer – «чистая» установка сервера: сервис, пользователь, srvinfo и т. д.
New-1CCurrentPlatformLink – создание символической ссылки C:\Program Files\1cv8\current
New-1CDistroPackage – распаковка дистрибутива в C:\1cv8.adm<версия>\<Servers><разрядность>
New-1CServiceUser – создание сервисного пользователя (запрос пароля)
Start-1CServerUpgrade – обновление сервера: последняя версия из дистрибутивов при наличии ссылки current
Test-1CModuleDependency – проверка зависимостей модуля
New-1CDefaultCompressTask – создание задачи планировщика для сжатия логов со стандартными параметрами (7 дн, хранение 90 дн, 05:00)
New-1CCustomCompressTask – создание задачи планировщика для сжатия логов с пользовательскими параметрами

Примеры использования

# Установка и импорт модуля

Install-Module -Name 1CMgmt -Force
Import-Module 1CMgmt

# Просмотр справки и списка команд

Get-1CModuleHelp

# Запуск установки сервера 1С через меню

Invoke-1CMenu

# Архивация логов старше 10 дней, хранение архивов 30 дней

Compress-1Clogs -FileDays 10 -ArchiveDays 30
