# Changelog

Все значимые изменения в проекте 1CMgmt документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

## [1.3.0] - 2025-11-26

### Добавлено
- **Умная установка**: `Install-1CServer` теперь пропускает установку MSI, если платформа уже установлена
- **Поддержка нескольких экземпляров**: Создание служб на разных портах без переустановки платформы
- **Ссылки currentXX**: Автоматическое создание junction-ссылок `current25`, `current35` и т.д.
- **Проверка портов**: Новая функция `Test-1CPortAvailable` проверяет доступность портов перед установкой
- **Диагностика экземпляров**: Новая функция `Test-1CServerInstance` для комплексной проверки конфигурации
- **Логирование установки**: Автоматическое создание лог-файлов в `C:\1Cv8.adm\logs\`
- **Интерактивные подтверждения**: Запрос подтверждения при пересоздании существующей службы
- **Автоматическое создание задачи обновления модуля**: При запуске меню автоматически создаётся задача, если её нет
- **Проверка зависимостей при запуске меню**: `Invoke-1CMenu` автоматически проверяет все зависимости

### Изменено
- **Install-1CServer**: Полностью переработана логика установки с поддержкой множественных экземпляров
- **New-1CCurrentPlatformLink**: Добавлен параметр `-PortPrefix` для создания дополнительных ссылок
- **Start-1CServerUpgrade**: Автоматическое обновление всех ссылок `currentXX` после обновления платформы
- **Test-1CModuleDependency**: Улучшена обработка ошибок при создании задачи обновления модуля
- Улучшено цветовое оформление вывода во всех функциях
- Добавлена валидация формата версии платформы

### Исправлено
- Проблема с повторной установкой MSI при создании службы на других портах
- Отсутствие проверки зависимостей при запуске меню
- Отсутствие автоматического создания задачи обновления модуля

### Структура после установки нескольких экземпляров
```
C:\Program Files\1cv8\
├── 8.3.25.1577\          # Установленная версия
├── current → 8.3.25.1577  # Junction для портов 15xx
├── current25 → current    # Junction для портов 25xx
├── current35 → current    # Junction для портов 35xx
├── srvinfo15\             # Данные службы Current
├── srvinfo25\             # Данные службы Current25
└── srvinfo35\             # Данные службы Current35
```

## [1.2.3] - 2025-11-26

### Исправлено
- Автоматическая проверка зависимостей при запуске меню
- Автоматическое создание задачи обновления модуля при её отсутствии

## [1.2.2] - 2024-11-17

### Добавлено
- Новое упрощённое главное меню `Invoke-1CMenu` с группировкой по категориям
- Подменю для установки с параметрами (`Invoke-InstallMenu`)
- Подменю для обновления с параметрами (`Invoke-UpgradeMenu`)
- Подменю для настройки автообновления (`Invoke-AutoUpgradeMenu`)
- Подменю для настройки архивации логов (`Invoke-LogArchiveMenu`)
- Консистентная навигация: `r` - назад, `q` - выход
- Подтверждение перед выполнением действий
- Улучшенная обработка ошибок во всех меню

### Изменено
- Полностью переработано главное меню (было 3 запутанных меню, стало 1 понятное)
- Упрощён README (сокращён на 38%, улучшена структура)
- `Invoke-1CMaintenanceMenu` теперь перенаправляет на `Invoke-1CMenu` (устарело)
- `Invoke-1CTaskMenu` теперь перенаправляет на `Invoke-1CMenu` (устарело)
- Улучшена визуальная структура меню с цветовым кодированием
- Добавлены таблицы и бейджи в README

### Исправлено
- Убрано дублирование примеров в документации
- Исправлены устаревшие ссылки на меню в README
- Улучшена читабельность документации

### Устарело
- `Invoke-1CMaintenanceMenu` - используйте `Invoke-1CMenu`
- `Invoke-1CTaskMenu` - используйте `Invoke-1CMenu`

## [1.1.3] - 2024-11-13

### Добавлено
- Поддержка установки из сетевых путей (UNC)
- Автоматическое копирование дистрибутивов в локальный кэш

### Изменено
- Улучшена обработка версий платформы
- Оптимизирована работа с архивами

## [1.1.0] - 2024-11-01

### Добавлено
- Поддержка множественных инстансов серверов (Current25, Current35)
- Автоматическое создание задач планировщика для обновления
- Функция `New-1CServerAutoUpgradeTask`

### Изменено
- Улучшена работа с портами
- Оптимизирована установка платформы

## [1.0.0] - 2024-10-15

### Добавлено
- Первый стабильный релиз
- Установка и обновление сервера 1С
- Архивация журналов регистрации
- Интерактивные меню
- Базовая автоматизация через планировщик

---

[1.2.2]: https://github.com/yourusername/1CMgmt/compare/v1.2.1...v1.2.2
[1.1.3]: https://github.com/yourusername/1CMgmt/compare/v1.1.0...v1.1.3
[1.1.0]: https://github.com/yourusername/1CMgmt/compare/v1.0.0...v1.1.0
[1.0.0]: https://github.com/yourusername/1CMgmt/releases/tag/v1.0.0
